# Centralized Telescope with BLS Signatures

## Flow of the example
- Create a list of `Signer`s. This list contains candidate signers.
- Start a new `Registration`.
- Register candidate signers.
- Close the registration.
- Create a list of `RegisteredSigner`s.
- Create a list of `IndividualSignature`s.
- Generate `AlbaThresholdSignature` based on collected signatures.
- Verify the alba threshold signature.

## Code structure
### Signer
- There are two types of signers:
  - `Signer`: 
    - Candidate signer, 
    - including only the signing key and its verification key.
    - Initialization of a new signer is done by `init` function.
    - A signer can register its verification key by `register` function if it is not already registered or the registration is still open. 
      - This will return a `RegisteredSigner` if registration succeeds.
  - `RegisteredSigner`:
    - is a signer whose verification key exists in registration. 
    - Contains signer's signing key, checksum (ff the registration is closed), and the registration index corresponding to signer's verification key.
    - After the registration is closed, registered signer update itself with `get_closed_registration` to fill its checksum from closed registration.
    - Registered signer can create an `IndividualSignature` by signing `commitment = Hash(checksum||msg)` with `sign` function.

### Registration
- Registration includes registered keys as a `BTreeMap` and the checksum of all registered keys.
- New registration is initialized by `new` function with an empty `BTreeMap`. Checksum is not initialized in this phase.
- Registration process is closed with `close` function if the registration is not already closed. It is done by hashing all verification keys registered into the `checksum`.

### Signature
- A single signature is represented with `IndividualSignature`. 
- It contains the bls signature and the index of the signer of signature.
- An `IndividualSignature` is verified by `verify` function with given verification key, against `commitment = Hash(checksum||msg)`.

### Helpers
- Get commitment:
  - Instead of signing only the message, the signature is generated by signing a commitment.
  - This is the helper function to compute a commitment by hashing `(checksum || msg)`.
- Collect valid signatures:
  - The prover set is built on the individual signatures.
  - Each individual signature is validated by checking if the signer of a signature is registered and the signature is valid.
  - Each valid signature is converted to its byte representation.
  - A hashmap, including the byte representation of a valid signature and its registration index is returned.
- Validate signatures:
  - The verifier needs to validate signatures that creates the alba proof. The process is as follows:
    - Convert each element in the element sequence of alba proof to a bls signature.
    - Aggregate collected signatures by calling `AggregateSignature::aggregate`.
    - Collect verification keys by using the indices. Get each verification key from registration if its index is included in `AlbaThresholdSignature.indices`.
    - Aggregate collected verification keys by calling `AggregatePublicKey::aggregate`.
    - Convert aggregated signature to a signature and aggregated public key to a public key.
    - Verify them using `verify` function of bls signatures against the commitment.

### ALBA Threshold Signature
- It includes the alba proof, indices of the elements exist in the alba proof, and the commitment.
- The `prove` function:
  - Checks whether the registration is closed,
  - Creates the commitment,
  - Collects the valid signatures with `collect_valid_signatures`,
  - If the length of valid signatures is less than the set size provided, abort the process,
  - Creates the prover set by collecting only the signatures from the hash map of valid signatures,
  - Creates the alba proof,
  - Collects the registration indices of the elements that are in the alba proof by using valid signatures hashmap.
  - Returns the alba proof, indices, and the commitment.
- The `verify` function:
  - Checks whether the registration is closed,
  - Creates the commitment and compares it with the provided commitment,
  - Verifies the signatures that creates the alba proof by calling `validate_signatures` function.
  - Verifies the alba proof.
